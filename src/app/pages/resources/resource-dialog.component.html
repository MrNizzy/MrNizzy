<!-- Modal Overlay -->
<div
  class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in"
>
  <div
    class="absolute inset-0 bg-black/60 backdrop-blur-sm"
    role="button"
    tabindex="0"
    aria-label="Close modal backdrop"
    (click)="closed.emit()"
  ></div>

  <div
    #modalContainer
    class="relative z-10 w-full max-w-3xl rounded-2xl border border-white/10 bg-black/90 p-6 shadow-2xl animate-scale-in"
    role="dialog"
    aria-modal="true"
    aria-label="Resource details"
  >
    <!-- Content -->
    @if (resource.isLoading()) {
    <div class="flex items-center gap-3 text-sm opacity-80">
      <span
        class="inline-block h-3 w-3 rounded-full bg-white/30 animate-pulse"
      ></span>
      Loading...
    </div>
    } @else if (resource.error(); as err) {
    <div
      class="text-red-400 bg-red-400/10 border border-red-400/30 rounded-xl p-4"
    >
      <p class="font-semibold">Failed to load resource</p>
      <p class="text-sm opacity-80 break-all">{{ err?.message ?? err }}</p>
    </div>
    } @else { @let sel = resource.value();
    <div class="flex items-start gap-4">
      <img
        [src]="sel.url_image"
        [alt]="sel.name"
        [title]="sel.name"
        class="h-20 w-20 rounded-xl object-cover border border-white/10 bg-black/30 flex-shrink-0"
      />
      <div class="flex-1 min-w-0">
        <h3 class="text-2xl font-bold tracking-wide">{{ sel.name }}</h3>
        <p class="mt-2 opacity-80">{{ sel.description }}</p>
        <div class="mt-3 flex flex-wrap gap-2">
          @for (t of sel.tags; track t) {
          <span
            class="text-xs px-2 py-1 rounded-full border border-white/10 bg-black/30"
            >{{ t }}</span
          >
          }
        </div>
        <div class="mt-4 grid grid-cols-2 gap-4 text-sm">
          <div class="flex items-center gap-2">
            <span class="opacity-70">Type:</span>
            <span class="capitalize">{{ sel.type }}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="opacity-70">Category:</span>
            <span class="capitalize">{{ sel.category }}</span>
          </div>
          <div class="flex items-center gap-2">
            <span class="opacity-70">Views:</span>
            {{ sel.view_count + viewDelta() }}
          </div>
          <div class="flex items-center gap-2">
            <span class="opacity-70">Upvotes:</span>
            {{ sel.upvotes + upvoteDelta() }}
          </div>
          <div class="flex items-center gap-2">
            <span class="opacity-70">Clicks:</span>
            {{ sel.click_count + clickDelta() }}
          </div>
        </div>
      </div>
      <button
        type="button"
        class="ml-2 rounded-lg border border-white/10 bg-black/30 hover:bg-black/40 px-3 py-1.5 cursor-pointer"
        (click)="closed.emit()"
        aria-label="Close"
      >
        ‚úï
      </button>
    </div>

    <div class="mt-6 flex items-center gap-3">
      <button
        type="button"
        class="text-sm px-3 py-2 rounded-lg border border-white/10 bg-black/30 hover:bg-black/40 transition-colors cursor-pointer"
        [class.animate-pop]="upvoting()"
        (click)="upvote(sel.resource_id)"
        aria-label="Upvote"
      >
        üëç Upvote
      </button>
      @if (sel.url) {
      <a
        [href]="sel.url"
        target="_blank"
        rel="noopener noreferrer"
        class="text-sm px-3 py-2 rounded-lg border border-white/10 bg-black/30 hover:bg-black/40 transition-colors cursor-pointer"
        (click)="trackClick(sel.resource_id)"
        >Visit Website</a
      >
      } @if (sel.url_repository) {
      <a
        [href]="sel.url_repository"
        target="_blank"
        rel="noopener noreferrer"
        class="text-sm px-3 py-2 rounded-lg border border-white/10 bg-black/30 hover:bg-black/40 transition-colors cursor-pointer"
        (click)="trackClick(sel.resource_id)"
        >View Repository</a
      >
      }
    </div>
    }
  </div>
</div>
